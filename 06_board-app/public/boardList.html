t<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시글 목록</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container list-container">
      <div class="header-group">
        <h2>게시글 목록</h2>
        <button onclick="location.href = '/board.html'" class="btn-write">
          새 글 작성
        </button>
      </div>

      <table class="board-table">
        <thead>
          <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일시</th>
          </tr>
        </thead>
        <tbody id="boardList">
          <tr>
            <td colspan="4" style="text-align: center">
              데이터를 불러오는 중...
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      // const list = async () => {
      //   try {
      //     const boardList = document.querySelector("#boardList");
      //     const result = await fetch("/api/board/");
      //     if (result.ok) {
      //       const data = await result.json();
      //       boardList.innerHTML = "";
      //       if (data.length === 0) {
      //         boardList.innerHTML =
      //           '<tr><td colspan="4" style="text-align:center;">등록된 게시글이 없습니다.</td></tr>';
      //         return;
      //       }
      //       data.forEach((ele) => {
      //         const tr = document.createElement("tr");
      //         const date = new Date(ele.created_at).toLocaleString();
      //         tr.innerHTML = `<td>${ele.board_id}</td>
      //               <td class="title-cell"><a href="#">${ele.title}</a></td>
      //               <td>${ele.writer_id}</td>
      //               <td>${date}</td>`;
      //         boardList.appendChild(tr);
      //       });
      //     } else {
      //       alert("목록 불러오기 실패");
      //     }
      //   } catch (err) {
      //     console.error("에러발생", err);
      //   }
      // };
      // list();

      const list = async () => {
        const parent = document.querySelector("#boardList");

        try {
          const result = await fetch("/api/board/");

          if (!result.ok) {
            throw new Error("서버 응답 에러");
          }

          const data = await result.json();
          parent.innerHTML = "";

          if (data.length === 0) {
            parent.innerHTML =
              '<tr><td colspan="4" style="text-align:center;">게시글이 없습니다.</td></tr>';
            return;
          }

          for (let board of data) {
            const { board_id, title, name, created_at } = board;

            const dateText = created_at
              ? new Date(created_at).toLocaleString()
              : "날짜없음";

            const html = `
        <tr>
          <td>${board_id}</td>
          <td class="text-left">
            <a href="boardDetail.html" data-page="${board_id}">${title}</a>
          </td>
          <td>${name}</td>
          <td>${dateText}</td>
        </tr>`;

            parent.insertAdjacentHTML("beforeend", html);
          }

          const anchors = document.querySelectorAll("tbody a");
          anchors.forEach((ele) => {
            ele.addEventListener("click", (e) => {
              e.preventDefault();

              const pageId = e.currentTarget.dataset.page;
              localStorage.setItem("page", pageId);
              location.href = "boardDetail.html";
            });
          });
        } catch (err) {
          console.error("목록 출력 중 에러발생:", err);
          parent.innerHTML =
            '<tr><td colspan="4" style="text-align:center; color:red;">데이터를 불러올 수 없습니다.</td></tr>';
        }
      };

      list();
    </script>
  </body>
</html>
